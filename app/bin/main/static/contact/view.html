<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>연락처</title>
</head>
<body>

<h1>연락처 상세정보</h1>

<form>
    이름* : <input id="x-name" type="text"><br>
    이메일* : <input id="x-email" type="text" readonly><br> <!--속성값이 없을 수도 있음 readonly같이ㅇㅇ값을 줘봤자 소용없음-->
    연락처* : <input id="x-tel" type="text"><br>
    회사 : <input id="x-company" type="text"><br>
    (*)항목은 필수 입력 항목입니다.<br>
    <button id="x-update-btn" type="button">등록</button>
    <button id="x-delete-btn" type="button">삭제</button>
    <button id="x-cancle-btn" type="button">취소</button>
</form>

<script>
    //1) URL에서 쿼리스트링(query String)을 추출한다.
    const arr = location.href.split("?")
    console.log(arr)
    if (arr.length == 1) {
        alert('요청 형식이 올바르지 않습니다.')
        throw 'URL 형식 오류.'
    }
    let qs = arr[1]
    console.log(qs)

    //2) 쿼리스트링에서 이메일 값을 추출한다.
    const params = new URLSearchParams(qs)
    const email = params.get('email')

        if (email == null) {
            alert('이메일 값이 없습니다')
            throw '파라미터 오류!'
        }
    console.log(email)


    const form = Array.from(document.querySelectorAll('form>input'))

    //3)서버에서 데이터 가져오기
    fetch(`/contact/get?email=${email}`)
        .then(function (response) {
            return response.text()
        })
        .then(function (contact) {
            const splitValues = contact.split(',')
            form[0].value = splitValues[0]
            form[1].value = splitValues[1]
            form[2].value = splitValues[2]
            form[3].value = splitValues[3]
        })





    const name = document.querySelector('#x-name')
    // const email = document.querySelector('#x-email')
    const tel = document.querySelector('#x-tel')
    const company = document.querySelector('#x-company')


    //3) 연락처 상세정보를 화면에 출력한다.



    document.querySelector('#x-update-btn').addEventListener('click', () => {

        console.log('form입니다', form)

        if (form[0].value == "" || form[2].value =="") {
            window.alert('*은 필수입력항목입니다.')
            return;
        }

        console.log('form입니다', form)

        fetch(`/contact/update?name=${form[0].value}&email=${form[1].value}&tel=${form[2].value}&company=${form[3].value}`)
            .then(function (response){
                return response.json()
            }).then(function (json){
            console.log('json입니다', json)
        }).catch(error => {
            alert('서버 오류입니다.')
            console.log(error)

        })
        window.location.href = "index.html"
    })

    document.querySelector('#x-cancle-btn').onclick = ()=> {
        window.location.href = 'index.html'
    }

    const delBtn = document.querySelector('#x-delete-btn')
    delBtn.addEventListener('click', () => {
        console.log('하이')
    })
</script>




</body>
</html>